name: Project Board Automation

on:
  issues:
    types: [opened, reopened, closed]
  pull_request:
    types: [opened, reopened, closed, ready_for_review, merged]

permissions:
  issues: write
  pull-requests: write
  repository-projects: write
  contents: read
  projects: write

jobs:
  add_to_project:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/add-to-project@v0.5.0
        with:
          project-url: https://github.com/users/rafaumeu/projects/4
          github-token: ${{ secrets.GH_TOKEN }}

      - name: Update issue status
        if: github.event_name == 'issues'
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GH_TOKEN }}
          script: |
            const status = context.payload.action === 'opened' ? 'ğŸ¯ Backlog' :
                          context.payload.action === 'closed' ? 'âœ… Done' : null;

            if (status) {
              await github.rest.projects.updateCard({
                card_id: context.payload.project_card.id,
                column_name: status
              });
            }

      - name: Update PR status
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GH_TOKEN }}
          script: |
            const status = context.payload.action === 'opened' ? 'ğŸ—ï¸ In Progress' :
                          context.payload.action === 'ready_for_review' ? 'ğŸ‘€ Review' :
                          (context.payload.action === 'closed' || context.payload.pull_request.merged) ? 'âœ… Done' : null;

            if (status) {
              await github.rest.projects.updateCard({
                card_id: context.payload.project_card.id,
                column_name: status
              });
            }
